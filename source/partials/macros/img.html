<!-- beautify ignore:start -->
{% macro lazy (url, alt, attrs = {}) %}
    {% set dimensions = image_size(url) %}
    {% if dimensions.width and dimensions.height %}
    {% set attrs = object_assign(attrs, {
        style: '--image-width:' + dimensions.width + ';' + '--image-height:' + dimensions.height + ';' + (attrs.style | default(''))
    }) %}
    {% endif %}
    <img
        src="{{ require(url) }}"
        {% if not attrs.loading %}
        loading="lazy"
        {% endif %}
        {% if dimensions.width and dimensions.height %}
        width="{{ dimensions.width }}"
        height="{{ dimensions.height }}"
        intrinsicsize="{{ dimensions.width }}x{{ dimensions.height }}"
        {% endif %}
        {% if alt %}alt="{{ alt }}"{% endif %}
        {% for k, v in attrs %} {{ k }}="{{ v }}"{% endfor %}
    >
{% endmacro %}

{% macro picture (url, alt, attrs={}) %}
    {% set dimensions = image_size(url) %}
    {% if dimensions.width and dimensions.height %}
    {% set attrs = object_assign(attrs, {
        style: '--image-width:' + dimensions.width + ';' + '--image-height:' + dimensions.height + ';' + (attrs.style | default(''))
    }) %}
    {% endif %}
    <picture{% for k, v in attrs %}{% if k != 'img' %} {{ k }}="{{ v }}"{% endif %}{% endfor %}>
        <img
            src="{{ require(url) }}"
            {% if not (attrs.img and attrs.img.loading) %}
            loading="lazy"
            {% endif %}
            {% if dimensions.width and dimensions.height %}
            width="{{ dimensions.width }}"
            height="{{ dimensions.height }}"
            intrinsicsize="{{ dimensions.width }}x{{ dimensions.height }}"
            {% endif %}
            {% if attrs.img %}{% for k, v in attrs.img %} {{ k }}="{{ v }}"{% endfor %}{% endif %}
            {% if alt %}alt="{{ alt }}"{% endif %}
        >
    </picture>
{% endmacro %}
<!-- beautify ignore:end -->